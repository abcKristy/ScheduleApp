# Schedule Service

## Описание проекта
**RESTful API сервер** для работы с расписанием занятий МИРЭА. Сервер предоставляет актуальное расписание для студентов, преподавателей и аудиторий, интегрируясь с официальным API МИРЭА и предоставляя удобный интерфейс для мобильных и веб-клиентов.

## Возможности

### Реализовано
- **Парсинг iCal формата** - преобразование данных из формата iCalendar в сущности занятий
- **Интеграция с MIREA API** - автоматическое получение актуального расписания
- **Многоуровневое хранение** - кэш → база данных → внешние источники
- **Поддержка всех сущностей** - группы, преподаватели, аудитории
- **Умное кэширование** - автоматическое обновление и проверка актуальности данных
- **Автоматическая синхронизация** - обновление ID из внешних источников
- **Типы занятий** - лекции (ЛК), практики (ПР), лабораторные (ЛАБ)
- **Повторяющиеся события** - поддержка recurring events через RRULE
- **Обработка ошибок** - централизованная обработка исключений

### Архитектура
```
Android Client → REST API → Schedule Service → [Cache → Database → External API]
```

## Технологический стек

- **Java 17+** - основной язык разработки
- **Spring Boot 3.x** - фреймворк
- **Spring Data JPA** - работа с базой данных
- **Hibernate** - ORM
- **PostgreSQL/MySQL** - реляционная БД
- **Maven** - управление зависимостями
- **REST Template** - HTTP клиент
- **Lombok** - уменьшение boilerplate кода

## API Endpoints

#### Полное расписание (кэш + БД + API)
```http
GET /schedule/final/{titles}
```
**Параметры:**
- `titles` - список сущностей через двоеточие

**Ответ:** Полный список занятий с приоритетом: кэш → БД → внешние источники

## База данных

### Основные таблицы
- `lessons` - занятия
- `groups` - учебные группы
- `teachers` - преподаватели
- `rooms` - аудитории
- `lesson_group`, `lesson_teacher`, `lesson_room` - связи ManyToMany
- `academic_weeks` - учебные недели
- `lesson_exceptions` - исключения для повторяющихся занятий

## Производительность

### Текущие метрики
- **Время ответа API**: ~150-300ms
- **Время парсинга iCal**: ~50-100ms на событие
- **Производительность БД**: оптимизирована для частых запросов
- **Память**: ~256MB RAM при стандартной нагрузке

### Мониторинг
- Логирование через SLF4J + Logback
- Метрики через Spring Boot Actuator
- Health checks на `/actuator/health`

## Обработка ошибок

Сервер возвращает стандартизированные ошибки:
```json
{
  "message": "Ошибка при получении данных из внешнего источника",
  "detailedMessage": "Connection timeout",
  "errorTime": "2024-01-15T12:00:00"
}
```

**Основные HTTP статусы:**
- `200` - успешный запрос
- `400` - некорректные параметры
- `404` - данные не найдены
- `503` - внешний API недоступен
- `500` - внутренняя ошибка сервера

## Процесс работы

1. **Получение запроса** от клиента с списком сущностей
2. **Валидация** типа и формата сущностей
3. **Поиск в кэше** (при реализации)
4. **Поиск в БД** с проверкой актуальности
5. **Запрос к внешнему API** при отсутствии данных
6. **Парсинг iCal** и преобразование в сущности
7. **Сохранение в БД** и обновление кэша
8. **Возврат результата** клиенту

## Интеграция с Android приложением

### Текущая реализация
Сервер полностью готов к интеграции с Android-клиентом на Kotlin. Предоставляет:
- **REST API** с JSON ответами
- **Стандартизированные ошибки** для обработки на клиенте
- **Поддержка всех типов сущностей** МИРЭА
- **Оптимизированные ответы** для мобильных устройств

### Рекомендации для Android разработки
```kotlin
// Пример использования с Retrofit
interface ScheduleApi {
    @GET("schedule/final/{titles}")
    suspend fun getSchedule(@Path("titles") titles: String): List<LessonDto>
}

// Рекомендуемая архитектура на Android
// ViewModel → Repository → Retrofit → Этот сервер
```

## Будущие улучшения

### Высокий приоритет
- [ ] **Реализация кэширования** (Redis/Hazelcast)
- [ ] **Пагинация ответов** для больших наборов данных
- [ ] **Rate limiting** для защиты API
- [ ] **Swagger/OpenAPI** документация

### Средний приоритет
- [ ] **Фоновая синхронизация** по расписанию
- [ ] **WebSocket** для push-уведомлений об изменениях
- [ ] **Расширенная фильтрация** по датам и типам занятий
- [ ] **График занятости аудиторий**

### Низкий приоритет
- [ ] **OAuth2 аутентификация**
- [ ] **Микросервисная архитектура**
- [ ] **Поддержка нескольких институтов**
- [ ] **Админ панель** для управления данными

## Разработка

### Требования
- Java 17+
- Maven 3.6+
- PostgreSQL 12+ или MySQL 8+

### Структура проекта
```
src/
├── main/
│   ├── java/org/schedule/
│   │   ├── controller/     # REST контроллеры
│   │   ├── service/        # Бизнес-логика
│   │   ├── repository/     # Доступ к данным
│   │   ├── entity/         # Сущности JPA
│   │   ├── mapping/        # Мапперы и парсеры
│   │   └── config/         # Конфигурация
│   └── resources/
└── test/
```
---
**Поддержка**: Android 8.0+ (API 26+)  

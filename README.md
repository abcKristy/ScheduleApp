# Schedule Application - Архитектура и реализация

## Серверная часть
1. [Общее описание](#общее-описание)
2. [Технологический стек](#технологический-стек)
3. [Архитектурные паттерны](#архитектурные-паттерны)
4. [Структура проекта](#структура-проекта)
5. [Реализация](#реализация)
6. [API эндпоинты](#api-эндпоинты)

## Приложение
1. [Технологический стек](#технологический-стек)
2. [Архитектурные паттерны](#архитектурные-паттерны)
3. [Структура проекта](#структура-проекта)
4. [Реализация](#реализация)
5. [API эндпоинты](#api-эндпоинты)
6. [Мобильное приложение](#мобильное-приложение)

## Общее описание

**Schedule Application** - это полнофункциональная система для управления академическим расписанием, состоящая из серверной части (backend) на Spring Boot и мобильного приложения на Android с использованием Kotlin и Jetpack Compose. Проект предназначен для образовательных учреждений и предоставляет удобный доступ к расписанию занятий для студентов и преподавателей.

### Основной функционал
- **Просмотр расписания** для групп, преподавателей и аудиторий
- **Автоматическое обновление** данных из официальных источников
- **Оффлайн-доступ** к расписанию через кэширование
- **Гибкий поиск** с историей запросов
- **Поддержка повторяющихся событий** и исключений

### Мобильное приложение
- **Современный интерфейс** на Jetpack Compose
- **Адаптивный дизайн** с поддержкой светлой и темной темы
- **Быстрая навигация** между разделами
- **Персонализация** профиля пользователя
- **Виджеты** для быстрого доступа к расписанию

### Технические особенности
- **Многоуровневое кэширование** данных
- **Оптимизированная работа с сетью**
- **Локальное хранение** данных через Room
- **Автоматическая синхронизация**
- **Обработка ошибок** и graceful degradation

## Технологический стек

### Backend
- **Java 17+** - основной язык программирования
- **Spring Boot 3.x** - фреймворк приложения
- **Spring Data JPA** - работа с базой данных
- **Hibernate** - ORM mapping
- **Maven** - управление зависимостями
- **RESTful Web Services** - API архитектура

### База данных
- **JPA/Hibernate** - объектно-реляционное отображение
- **Реляционная БД** (H2/PostgreSQL/MySQL) - хранение данных
- **Миграции через JPA** - управление схемой БД

### Внешние интеграции
- **MIREA Schedule API** - внешний источник данных
- **RestTemplate** - HTTP клиент для API запросов
- **iCalendar парсинг** - обработка формата расписания

### Вспомогательные технологии
- **SLF4J + Logback** - логирование
- **Bean Validation** - валидация данных
- **Lombok** - сокращение boilerplate кода
- **Jackson** - JSON сериализация

## Архитектурные паттерны

### 1. Многослойная архитектура (Layered Architecture)
```
┌─────────────────┐
│   Controller    │ - REST API слой
├─────────────────┤
│    Service      │ - бизнес-логика
├─────────────────┤
│  Repository     │ - доступ к данным
├─────────────────┤
│   Entity/JPA    │ - модель данных
└─────────────────┘
```

### 2. DTO паттерн (Data Transfer Object)
- `ScheduleRequestDto` - для входных данных
- `ScheduleResponseDto` - для выходных данных
- `ResponseDto` - для промежуточных преобразований

### 3. Сервисный слой (Service Layer)
- Инкапсуляция бизнес-логики
- Разделение ответственности (Read/Write services)
- Транзакционное управление

### 4. Repository паттерн
- Абстракция доступа к данным
- JPA репозитории для каждой сущности
- Кастомные запросы через `@Query`

### 5. Фасад паттерн
- `ScheduleService` как фасад для сложных операций
- Упрощение клиентского API
- Координация между сервисами

## Структура проекта

### Пакеты и модули

```
src/main/java/org/schedule/
├── config/                    # Конфигурация
│   └── AppConfig.java        # Конфигурационные бины
├── entity/                    # Сущности и DTO
│   ├── forBD/                # Сущности БД
│   │   ├── basic/            # Основные сущности
│   │   └── enums/            # Перечисления
│   ├── apidata/              # DTO для внешнего API
│   └── schedule/             # DTO расписания
├── repository/               # Репозитории данных
│   ├── LessonRepository.java
│   ├── GroupRepository.java
│   ├── TeacherRepository.java
│   └── RoomRepository.java
├── reservations/             # Контроллеры и сервисы
│   ├── ScheduleController.java
│   ├── ScheduleService.java
│   ├── ScheduleReadService.java
│   └── ScheduleWriteService.java
├── mapping/                  # Мапперы и утилиты
│   ├── ScheduleMapper.java
│   ├── ParserToLesson.java
│   ├── CheckDataInMemory.java
│   ├── DataGetter.java
│   └── SaverToMemory.java
└── errors/                   # Обработка ошибок
    ├── GlobalExceptionHandler.java
    └── ErrorResponseDto.java
```

## Реализация

### Основной поток данных

#### 1. Получение расписания
```
Запрос → Контроллер → ScheduleService → Многоуровневый поиск:
    1. Память/кэш (CheckDataInMemory)
    2. База данных (ScheduleReadService) 
    3. Внешнее API (ScheduleMapper + ParserToLesson)
    4. Сохранение в БД (ScheduleWriteService)
```

#### 2. Обработка iCalendar данных
```java
// Парсинг внешнего API ответа
List<ResponseDto> response = scheduleMapper.mapToResponseDto(entities, API_URL);
List<ScheduleDto> schedule = scheduleMapper.mapToScheduleDto(response);
List<LessonEntity> lessons = scheduleMapper.parseStringData(schedule);

// Сохранение с дедупликацией
writeService.saveLessonsAndUpdateIds(lessons, response);
```

#### 3. Многоуровневое кэширование
- **Валидация сущностей** - проверка корректности входных данных
- **Проверка в БД** - поиск существующих записей
- **Внешний источник** - обновление из API при необходимости
- **Дедупликация** - устранение дубликатов при сохранении

### Ключевые особенности реализации

#### Оптимизация производительности
- **Пакетная обработка** - массовые операции с данными
- **N+1 решение** - оптимизированные запросы к БД
- **Параллельная обработка** - для больших объемов данных
- **Дедупликация** - предотвращение дублирования записей

#### Обработка ошибок
- **Глобальный exception handler** - централизованная обработка
- **Graceful degradation** - продолжение работы при частичных сбоях
- **Детальное логирование** - отслеживание всех операций

#### Транзакционность
- **Read-only транзакции** - для операций чтения
- **Write транзакции** - для операций записи
- **Разделение ответственности** - между сервисами

## API эндпоинты

### Основной эндпоинт
```http
GET /schedule/final/{entities}
```

**Параметры:**
- `entities` - список сущностей через `:` (группы, преподаватели, аудитории)

**Пример:**
```http
GET /schedule/final/ИВБО-01-20:ИВБО-02-20:Иванов И.И.:А-101
```

**Ответ:** Массив объектов `ScheduleResponseDto` с детальной информацией о занятиях.

### Формат ответа
```json
[
  {
    "discipline": "Математика",
    "lessonType": "LK",
    "startTime": "2024-01-15T09:00:00",
    "endTime": "2024-01-15T10:30:00",
    "room": "А-101",
    "teacher": "Иванов И.И.",
    "groups": ["ИВБО-01-20", "ИВБО-02-20"],
    "recurrence": {
      "frequency": "WEEKLY",
      "interval": 1,
      "until": "2024-06-15T00:00:00"
    },
    "exceptions": ["2024-03-08"]
  }
]
```

## Масштабируемость и поддержка

Система разработана с учетом возможного масштабирования:
- Модульная архитектура для легкого расширения
- Поддержка различных источников данных
- Гибкая конфигурация через Spring Boot
- Подготовка для кластерного развертывания

# Мобильное приложение

### Технологический стек клиента
- **Kotlin** - основной язык разработки
- **Jetpack Compose** - современный UI фреймворк
- **Room Database** - локальное хранение данных
- **Retrofit** - HTTP клиент для API запросов
- **Coil** - загрузка и кэширование изображений
- **Material Design 3** - система дизайна

### Архитектура приложения

#### 1. Многослойная архитектура
```
┌─────────────────┐
│    UI Layer     │ - Composable экраны
├─────────────────┤
│  Domain Layer   │ - бизнес-логика и Use Cases
├─────────────────┤
│  Data Layer     │ - репозитории и источники данных
└─────────────────┘
```

#### 2. Паттерны проектирования
- **MVVM (Model-View-ViewModel)** - управление состоянием UI
- **Repository Pattern** - абстракция доступа к данным
- **Singleton Pattern** - управление глобальным состоянием

### Ключевые компоненты

#### Навигация
- **NavController** - управление навигацией между экранами
- **MainNavGraph** - граф навигации приложения
- **BottomNav** - нижняя панель навигации

#### Основные экраны
- **MainScreen** - главный экран с навигацией
- **ScreenProfile** - профиль пользователя
- **ScreenList** - список расписания
- **ScreenSearch** - поиск групп/преподавателей
- **WelcomeScreen** - экран приветствия

#### Управление состоянием
- **AppState** - глобальное состояние приложения (Singleton)
- **ThemeViewModel** - управление темой оформления
- **PreferencesManager** - работа с SharedPreferences

### Работа с данными

#### Локальное хранение
```kotlin
// Room Database entities
@Entity(tableName = "schedule_items")
data class ScheduleEntity

// Data Access Object
@Dao
interface ScheduleDao

// Repository
class ScheduleRepository
```

#### Сетевое взаимодействие
```kotlin
// Retrofit service
interface ScheduleApiService

// Data parsing
fun parseScheduleFromResponse()
suspend fun getScheduleItemsWithCache()
```

#### Кэширование данных
- **Многоуровневое кэширование** - память → локальная БД → сервер
- **Автоматическое обновление** - при отсутствии данных в кэше
- **Оффлайн-работа** - использование сохраненных данных

### Особенности реализации

#### UI/UX
- **Адаптивный дизайн** - поддержка светлой и темной темы
- **Анимированные элементы** - плавные переходы и интерактивность
- **Кастомные компоненты** - уникальный дизайн системы

#### Производительность
- **Ленивая загрузка** - оптимизация списков через LazyColumn
- **Фоновые операции** - использование корутин для асинхронности
- **Эффективное кэширование** - минимизация сетевых запросов

#### Функциональность
- **Поиск с историей** - сохранение предыдущих запросов
- **Гибкое отображение** - настройка показа пустых пар
- **Интеграция с СДО** - прямые ссылки на образовательную платформу

### Настройки и персонализация
- **Выбор темы** - светлая/темная тема оформления
- **Настройки профиля** - имя, группа, email, аватар
- **Предпочтения отображения** - показ/скрытие пустых пар

## Масштабируемость и поддержка

Система разработана с учетом возможного масштабирования:
- Модульная архитектура для легкого расширения
- Поддержка различных источников данных
- Гибкая конфигурация через Spring Boot
- Подготовка для кластерного развертывания
- Кроссплатформенная совместимость мобильного приложения
